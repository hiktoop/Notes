# 查询处理

这部分内容的原理比较简单，但是性能分析十分繁重，所以仅列出大纲，后续有机会再深入推导性能的部分

## 选择运算

- 文件扫描

- 索引

## 排序

- 外部排序归并算法

## 连接运算

- 嵌套循环连接

- 块嵌套循环连接

- 索引嵌套循环连接

- 归并连接

- 散列连接

## 其他运算

### 去重

- 排序去重

- 散列去重

## 投影

## 集合运算

- 排序

- 散列

### 外连接

### 聚集

- 排序

- 散列

## 表达式计算

- 物化：自低向上，建立临时关系

- 流水线：多个关系操作组合成一个操作，操作的结果直接传输给下一个
  
  - 生产者驱动：下层缓冲区取，操作后输出到上层缓冲区
  
  - 需求驱动：open, next, close

## 总结

- 对于一个查询，系统首先要做的事就是将之翻译成系统内部表示形式。对于关系数据库系统而言，内部形式通常是基于关系代数的。在产生查询的内部形式过程中，语法分析器检查用户查询语言的语法，验证出现在查询语句中的关系名是数据库中的关系名等。如果查询语句是用视图表示的，语法分析器把所有对视图名的引用替换为计算该视图的关系代数表达式。

- 给定一个查询，通常有许多计算它的方法。将用户输入的查询语句转化成等价的、执行效率更高的查询语句，这是优化器的责任。

- 对于包含简单选择的查询语句，可以通过线性扫描或利用索引来处理。通过计算简单选择结果的并和交，可以处理复杂选择操作。

- 可以用外部归并排序算法对大于内存的关系进行排序。

- 涉及自然连接的查询语句可以有多种处理方式，如何处理取决于是否有索引可用以及关系的物理存储形式。
  
  - 若连接的结果大小几乎与两个关系的笛卡尔积相当，则采用块嵌套循环连接策略较好。
  
  - 若存在索引，则可用索引嵌套循环连接。
  
  - 若关系已排序，则归并连接比较可取。在连接计算前对关系排序是有利的。
  
  - 散列连接算法把关系划分为多个部分，使每个部分都能被内存所容纳。划分过程是通过连接属性上的散列函数来进行的，这样相应的划分对可以独立的进行连接。

- 去重、投影、集合操作（并、交、差）、聚集操作都可以用排序和散列实现。

- 外连接操作可以通过对连接算法的简单扩展来实现。

- 散列与排序在某种意义下是对偶的。因为任何能用散列实现的操作也可以用排序来实现，反之亦然。

- 可以采用物化方法进行表达式的计算。系统计算每个子表达式的结果并将其存到磁盘上，然后用它进行父表达式的计算。

- 流水线方法在子表达式产生输出的同时就在父表达式的计算中使用其输出结果，帮助我们避免了将许多子查询的结果写入磁盘的操作。






















































